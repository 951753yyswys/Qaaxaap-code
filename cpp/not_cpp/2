#include<bits/stdc++.h>
using namespace std;
struct edge
{
	int to,nxt;
} e[1001000];
int head[100100],cnt;
struct tree
{
	int l,r,sum,lz;
} t[1000100];
void pushdown(int ro)
{
	if(t[ro].lz==-1) return;
	t[ro*2].lz=t[ro*2+1].lz=t[ro].lz;
	t[ro*2].sum=t[ro].lz*(t[ro*2].r-t[ro*2].l+1);
	t[ro*2+1].sum=t[ro].lz*(t[ro*2+1].r-t[ro*2+1].l+1);
	t[ro].lz=-1;
}
void pushup(int ro)
{
	t[ro].sum=t[ro*2].sum+t[ro*2+1].sum;
}
void build(int ro,int l,int r)
{
	t[ro]={l,r,0,-1};
	if(l==r) return;
	int mid=l+r>>1;
	build(ro*2,l,mid);
	build(ro*2+1,mid+1,r);
	pushup(ro);
}
void update(int ro,int l,int r,int v)
{
	cout<<"update:"<<l<<' '<<r<<endl;
	cout<<"now:"<<t[ro].l<<' '<<t[ro].r<<endl;
	if(t[ro].l>=l&&t[ro].r<=r) 
	{
		t[ro].lz=v;
		t[ro].sum=v*(t[ro].r-t[ro].l+1);
		return;
	}
	pushdown(ro);
	int mid=t[ro].l+t[ro].r>>1;
	if(l<=mid) update(ro*2,l,r,v);
	if(r>mid) update(ro*2+1,l,r,v);
	pushup(ro);
	cout<<"now:"<<t[ro].l<<' '<<t[ro].r<<' '<<t[ro].sum<<endl;
}
int query(int ro,int l,int r)
{
	if(t[ro].l>=l&&t[ro].r<=r) return t[ro].sum;
	pushdown(ro);
	int ans=0,mid=t[ro].l+t[ro].r>>1;
	if(l<=mid) ans+=query(ro*2,l,r);
	if(r>mid) ans+=query(ro*2+1,l,r);
	return ans;
}
void add(int u,int v)
{
	cnt++;
	e[cnt].to=v;
	e[cnt].nxt=head[u];
	head[u]=cnt;
}
int fa[1001000],dfn[1001000],son[1001000],siz[1001000],dep[1001000];
int top[1001000],num,mso[1001000],n;
void dfs1(int u,int f)
{
	fa[u]=f;
	siz[u]=1;
	dep[u]=dep[f]+1;
	son[u]=-1;
	int mx=-1;
	for(int i=head[u];i;i=e[i].nxt)
	{
		int v=e[i].to;
		if(v==f) continue;
		dfs1(v,u);
		siz[u]+=siz[v];
		if(mx<siz[v]) mx=siz[v],son[u]=v;
	}
}
void dfs2(int u,int t)
{
	dfn[u]=++num;
	mso[u]=dfn[u];
	top[u]=t;
	if(son[u]==-1) return;
	dfs2(son[u],t);
	mso[u]=max(mso[u],mso[son[u]]);
	for(int i=head[u];i;i=e[i].nxt)
	{
		int v=e[i].to;
		if(son[u]==v||fa[u]==v) continue;
		dfs2(v,v);
		mso[u]=max(mso[u],mso[v]);
	}
}
int apt(int opt,int ro)
{
	int yk=query(1,1,n);
	if(opt==1)
	{
		while(ro!=0) 
		{
			update(1,dfn[top[ro]],dfn[ro],1);
			ro=fa[top[ro]];
		}
		return query(1,1,n)-yk;
	}
	else
	{
		update(1,dfn[ro],mso[ro],0);
		return yk-query(1,1,n);
	}
}
int main()
{
	cin>>n;
	for(int i=2;i<=n;i++)
	{
		int u;
		cin>>u;
		add(i,u+1);
		add(u+1,i);
	}
	dfs1(1,0);
	dfs2(1,1);
	build(1,1,n);
	int q;
	cin>>q;
	cout<<query(1,1,n);
	while(q--)
	{
		string s;
		int ro;
		cin>>s>>ro;
		cout<<"ans:";
		if(s=="install") cout<<apt(1,ro+1)<<endl;
		else cout<<apt(0,ro+1)<<endl;
	}
	for(int i=1;i<=n;i++) cout<<dfn[i]<<' ';
	cout<<endl;
	for(int i=1;i<=n;i++) cout<<top[i]<<' ';
	cout<<endl;
	for(int i=1;i<=n;i++) cout<<mso[i]<<' ';
	cout<<endl;
	for(int i=1;i<=n;i++) cout<<fa[i]<<' ';
	return 0;
}
